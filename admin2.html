<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Turnierverwaltung</title>
  <style>
    body {
      font-family: sans-serif;
      background: white;
      color: #222;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    nav {
      text-align: center;
      margin-bottom: 20px;
    }

    nav a {
      margin: 0 10px;
      color: #007b00;
      text-decoration: none;
      font-weight: bold;
    }

    .teams, .spiele {
      max-width: 900px;
      margin: 0 auto 30px;
    }

    .teams input {
      width: calc(100% / 2 - 10px);
      padding: 8px;
      margin: 5px;
      font-size: 1em;
    }

    button {
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 1em;
      cursor: pointer;
    }

    .spiel {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
      margin: 10px 0;
    }

    .spiel input[type="number"] {
      width: 40px;
      font-size: 1em;
      text-align: center;
    }

    .zeit-platz {
      font-size: 0.9em;
      color: #555;
    }

    .timer{
      position: fixed;
      right: 20px;
      top: 20px;
      background: #f4f4f4;
      border: 1px solid #ccc;
      padding: 10px;
      font-size: 1.2em;
      border-radius: 8px;
    }

    .checkbox {
      float: right;
    }
  </style>
</head>
<body>
  <h1>⚽ Turnierverwaltung</h1>

  <nav>
    <a href="live.html" target="_blank">Live-Anzeige</a> |
    <a href="uebersicht.html" target="_blank">Übersicht</a> |
    <a href="tabelle.html" target="_blank">Tabelle</a> |
    <a href="viertelfinale.html" target="_blank">Viertelfinale</a>
  </nav>

  <div class="teams" id="teamEingabe">
    <h2>Teamnamen eingeben (10 Teams)</h2>
    <div id="teamInputs"></div>
    <button onclick="spielplanErzeugen()">Spielplan automatisch erstellen</button>
    <button onclick="localStorage.clear(); location.reload()">Speicher leeren</button>
  </div>
  <div class="spiele" id="spielplan">
    <h2>Spielplan</h2>
    <div id="spielListe"></div>
    <button onclick="gruppenphaseBeenden()">Gruppenphase beenden</button>
    <button onclick="viertelfinaleBeenden()">Viertelfinale beenden</button>
    <button onclick="halbfinaleBeenden()">Halbfinale beenden</button>
  </div>

  <div class="timer">
    <h4>⏱️ Stoppuhr</h4>
    <div id="stopuhr">00:00</div>
    <button onclick="startUhr()">Start</button>
    <button onclick="pauseUhr()">Pause</button>
    <button onclick="resetUhr()">Reset</button>
  </div>

  <script>
      let interval = null;

        function updateUhr() {
          const start = localStorage.getItem("stoppuhr_start");
          const pause = localStorage.getItem("stoppuhr_pause");
          const running = localStorage.getItem("stoppuhr_running") === "true";
          let diff = 0;

          if (start) {
            const startTime = parseInt(start);
            const now = Date.now();
            diff = running
              ? Math.floor((now - startTime) / 1000)
              : Math.floor((parseInt(pause || now) - startTime) / 1000);
          }

          const min = String(Math.floor(diff / 60)).padStart(2, '0');
          const sec = String(diff % 60).padStart(2, '0');
          document.getElementById("stopuhr").textContent = `${min}:${sec}`;
        }

        function startUhr() {
          if (!localStorage.getItem("stoppuhr_start")) {
            localStorage.setItem("stoppuhr_start", Date.now());
          }
          localStorage.setItem("stoppuhr_running", "true");
          localStorage.removeItem("stoppuhr_pause");

          if (!interval) {
            interval = setInterval(updateUhr, 1000);
          }

          // Ton abspielen bei Start
          const audio = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
          audio.play();
        }

        function pauseUhr() {
          localStorage.setItem("stoppuhr_running", "false");
          localStorage.setItem("stoppuhr_pause", Date.now());
          clearInterval(interval);
          interval = null;
        }

        function resetUhr() {
          localStorage.removeItem("stoppuhr_start");
          localStorage.removeItem("stoppuhr_pause");
          localStorage.setItem("stoppuhr_running", "false");
          clearInterval(interval);
          interval = null;
          document.getElementById("stopuhr").textContent = "00:00";
        }

        // automatisch bei Seitenaufruf
        updateUhr();
        if (localStorage.getItem("stoppuhr_running") === "true") {
          interval = setInterval(updateUhr, 1000);
        }

    function renderTeamInputs() {
      const container = document.getElementById("teamInputs");
      container.innerHTML = "";
      for (let i = 0; i < 10; i++) {
        const input = document.createElement("input");
        input.placeholder = `Team ${i + 1}`;
        input.value = localStorage.getItem("teams") ? JSON.parse(localStorage.getItem("teams"))[i] || "" : "";
        input.oninput = () => speichereTeams();
        container.appendChild(input);
      }
    }

    function speichereTeams() {
      const inputs = document.querySelectorAll("#teamInputs input");
      const teams = Array.from(inputs).map(i => i.value.trim());
      localStorage.setItem("teams", JSON.stringify(teams));
    }

      function spielplanErzeugen() {
          const spiele = [];
          const zeitStart = new Date();
          zeitStart.setHours(11, 0, 0, 0); // Start: 11:00 Uhr
          let aktuelleZeit = new Date(zeitStart);

          const gruppeA = [0, 1, 2, 3, 4]; // Teams 1–5
          const gruppeB = [5, 6, 7, 8, 9]; // Teams 6–10

          function kombi(arr) {
            let erg = [];
            for (let i = 0; i < arr.length; i++) {
              for (let j = i + 1; j < arr.length; j++) {
                erg.push([arr[i], arr[j]]);
              }
            }
            return erg;
          }

          const paareA = kombi(gruppeA); // 10 Paarungen
          const paareB = kombi(gruppeB); // 10 Paarungen

          for (let i = 0; i < 10; i++) {
            spiele.push({
              t1: paareA[i][0],
              t2: paareA[i][1],
              g: `Gruppe A Spiel ${i + 1}`,
              gruppe: "A",
              platz: 1,
              zeit: new Date(aktuelleZeit),
            });
            spiele.push({
              t1: paareB[i][0],
              t2: paareB[i][1],
              g: `Gruppe B Spiel ${i + 1}`,
              gruppe: "B",
              platz: 2,
              zeit: new Date(aktuelleZeit),
            });
            aktuelleZeit.setMinutes(aktuelleZeit.getMinutes() + 15); // 10 Min Spiel + 5 Min Pause
          }

          localStorage.setItem("spiele", JSON.stringify(spiele));
          renderSpielplan();

    }

    function renderSpielListe() {
      const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
      const teams = JSON.parse(localStorage.getItem("teams") || "[]");
      const container = document.getElementById("spielListe");
      container.innerHTML = "";

      spiele.forEach((s, i) => {
        const div = document.createElement("div");
        div.className = "spiel";
        const zeit = new Date(s.zeit).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        div.innerHTML = `
          <strong>${s.g || "KO-Spiel"}:</strong> ${teams[s.t1] || `Team ${s.t1 + 1}`} 
          <input type="number" value="${s.g1 ?? '-'}" onchange="updateTor(${i}, 'g1', this.value)"> :
          <input type="number" value="${s.g2 ?? '-'}" onchange="updateTor(${i}, 'g2', this.value)">
          ${teams[s.t2] || `Team ${s.t2 + 1}`}
          <span class="zeit-platz">– ${zeit} – Platz ${s.platz}</span>
          <label class="checkbox"><input type="checkbox" onchange="toggleLive(${i}, this.checked)" ${localStorage.getItem('liveSpielIndex_' + i) === 'true' ? 'checked' : ''}> Live</label>
        `;
        container.appendChild(div);
      });
    }

    function updateTor(index, team, value) {
      const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
      spiele[index][team] = parseInt(value);
      localStorage.setItem("spiele", JSON.stringify(spiele));
    }

    function toggleLive(index, checked) {
      const key = "liveSpielIndex_" + index;
      if (checked) {
        localStorage.setItem(key, "true");
      } else {
        localStorage.removeItem(key);
      }
    }
      function gruppenphaseBeenden() {
        const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
        const teams = JSON.parse(localStorage.getItem("teams") || "[]");

        // Tabelle berechnen
        const stats = Array.from({ length: 10 }, (_, i) => ({
          index: i,
          gruppe: i < 5 ? 'A' : 'B',
          punkte: 0,
          tore: 0,
          gegentore: 0
        }));

        spiele.forEach(s => {
          if (!s.g?.startsWith("Gruppe")) return;
          const t1 = stats[s.t1];
          const t2 = stats[s.t2];
          if (typeof s.g1 !== "number" || typeof s.g2 !== "number") return;

          t1.tore += s.g1;
          t1.gegentore += s.g2;
          t2.tore += s.g2;
          t2.gegentore += s.g1;

          if (s.g1 > s.g2) t1.punkte += 3;
          else if (s.g1 < s.g2) t2.punkte += 3;
          else {
            t1.punkte += 1;
            t2.punkte += 1;
          }
        });

        const sortiert = gruppe =>
          stats
            .filter(t => t.gruppe === gruppe)
            .sort((a, b) =>
              b.punkte - a.punkte ||
              (b.tore - b.gegentore) - (a.tore - a.gegentore)
            );

        const topA = sortiert('A').slice(0, 4);
        const topB = sortiert('B').slice(0, 4);
        const lastA = sortiert('A')[4];
        const lastB = sortiert('B')[4];

        const zeit = new Date("2025-06-11T13:30:00"); // nach Gruppenphase
        const vf = [
          { g: "VF1", t1: topA[0].index, t2: topB[3].index, platz: 1 },
          { g: "VF2", t1: topB[0].index, t2: topA[3].index, platz: 2 },
          { g: "VF3", t1: topA[1].index, t2: topB[2].index, platz: 1 },
          { g: "VF4", t1: topB[1].index, t2: topA[2].index, platz: 2 },
          { g: "Platz 9", t1: lastA.index, t2: lastB.index, platz: 2 }
        ];

        for (let i = 0; i < vf.length; i++) {
          vf[i].zeit = new Date(zeit);
          zeit.setMinutes(zeit.getMinutes() + 15); // 10 + 5 Pause
        }

        const alle = [...spiele, ...vf.map(s => ({ ...s, g1: "-", g2: "-" }))];
        localStorage.setItem("spiele", JSON.stringify(alle));
        renderSpielListe();
      }

      function viertelfinaleBeenden() {
        const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
        const vf = spiele.filter(s => s.g?.startsWith("VF"));

        const sieger = vf.map(s => {
          if (s.g1 > s.g2) return s.t1;
          if (s.g2 > s.g1) return s.t2;
          return null;
        });

        const zeit = new Date("2025-06-11T14:40:00");
        const hf = [
          { g: "HF1", t1: sieger[0], t2: sieger[1], platz: 1 },
          { g: "HF2", t1: sieger[2], t2: sieger[3], platz: 1 }
        ];

        for (let i = 0; i < hf.length; i++) {
          hf[i].zeit = new Date(zeit);
          zeit.setMinutes(zeit.getMinutes() + 20); // 15 + 5 Pause
        }

        const alle = [...spiele, ...hf.map(s => ({ ...s, g1: "-", g2: "-" }))];
        localStorage.setItem("spiele", JSON.stringify(alle));
        renderSpielListe();
      }

      function halbfinaleBeenden() {
        const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
        const hf = spiele.filter(s => s.g?.startsWith("HF"));

        const sieger = hf.map(s => (s.g1 > s.g2 ? s.t1 : s.t2));
        const verlierer = hf.map(s => (s.g1 < s.g2 ? s.t1 : s.t2));

        const zeit = new Date("2025-06-11T15:50:00");

        const finalrunde = [
          { g: "Platz 3", t1: verlierer[0], t2: verlierer[1], platz: 1 },
          { g: "Finale", t1: sieger[0], t2: sieger[1], platz: 1 }
        ];

        for (let i = 0; i < finalrunde.length; i++) {
          finalrunde[i].zeit = new Date(zeit);
          zeit.setMinutes(zeit.getMinutes() + 35); // 2×15 + 5 Pause
        }

        const alle = [...spiele, ...finalrunde.map(s => ({ ...s, g1: "-", g2: "-" }))];
        localStorage.setItem("spiele", JSON.stringify(alle));
        renderSpielListe();
      }

      // Initialisierung beim Laden
      renderTeamInputs();
      renderSpielListe();
    </script>
  </body>
  </html>
