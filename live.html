<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Live-Spiele</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #145214, #003f00);
      color: white;
      font-family: sans-serif;
      height: 100%;
      overflow: hidden;
    }

    .global-timer {
      position: fixed;
      top: 80px;
      right: 100px;
      font-size: 4vw;
      background: rgba(255, 255, 255, 0.2);
      padding: 10px 20px;
      border-radius: 10px;
    }

    .container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100%;
      gap: 2vh;
      padding: 2vh;
      box-sizing: border-box;
    }

    .spielfeld {
      position: relative;
      border: 2px solid white;
      border-radius: 10px;
      padding: 2vw;
      min-width: 40vw;
      max-width: 90vw;
      width: 100%;
      box-sizing: border-box;
      text-align: center;
    }

    .spiel-info {
      font-size: 1.5vw;
      margin-bottom: 1vh;
    }

    .teams {
      display: flex;
      justify-content: space-around;
      align-items: center;
      font-size: 4vw;
      font-weight: bold;
      margin: 1vh 0;
    }

    .score {
      font-size: 5vw;
    }

    .grid-2 {
        display: flex;
        flex-direction: column;
        gap: 2vh;
        width: 100%;
        align-items: center;
      }

    .grid-3,
    .grid-1 {
      display: flex;
      flex-direction: column;
      gap: 2vh;
      width: 100%;
      align-items: center;
    }

    .grid-4 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: auto auto;
      gap: 2vh;
      width: 100%;
      justify-items: center;
    }
  </style>
</head>
<body>
  <div class="global-timer" id="globalTime">00:00</div>
  <div class="container" id="liveContainer"></div>

  <script>
    function ladeLiveSpiele() {
      const teams = JSON.parse(localStorage.getItem("teams") || "[]");
      const spiele = JSON.parse(localStorage.getItem("spiele") || "[]");
      const container = document.getElementById("liveContainer");

      const aktiveIndizes = spiele
        .map((spiel, index) => ({spiel, index}))
        .filter((_, i) => localStorage.getItem("liveSpielIndex_" + i) === "true")
        .map(s => s.index);

      const layoutClass = aktiveIndizes.length === 1 ? "grid-1" :
                          aktiveIndizes.length === 2 ? "grid-2" :
                          aktiveIndizes.length === 3 ? "grid-3" : "grid-4";

      container.className = `container ${layoutClass}`;
      container.innerHTML = "";

      aktiveIndizes.forEach(i => {
        const s = spiele[i];
        if (!s) return;

        const t1 = teams[s.t1] || `Team ${s.t1 + 1}`;
        const t2 = teams[s.t2] || `Team ${s.t2 + 1}`;
        const g1 = s.g1 ?? "-";
        const g2 = s.g2 ?? "-";
        const uhrzeit = new Date(s.zeit).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const bezeichnung = s.g || `Spiel ${i + 1}`;
        const platz = s.platz || 1;

        const spielDiv = document.createElement("div");
        spielDiv.className = "spielfeld";
        spielDiv.innerHTML = `
          <div class="spiel-info">${bezeichnung} – ${uhrzeit} – Platz ${platz}</div>
          <div class="teams">
            <span>${t1}</span>
            <span class="score">${g1} : ${g2}</span>
            <span>${t2}</span>
          </div>
        `;
        container.appendChild(spielDiv);
      });
    }

    function updateGlobalUhr() {
      const start = localStorage.getItem("stoppuhr_start");
      const pause = localStorage.getItem("stoppuhr_pause");
      const running = localStorage.getItem("stoppuhr_running") === "true";
      let diff = 0;

      if (start) {
        const startTime = parseInt(start);
        const now = Date.now();
        diff = running
          ? Math.floor((now - startTime) / 1000)
          : Math.floor((parseInt(pause || now) - startTime) / 1000);
      }

      const min = String(Math.floor(diff / 60)).padStart(2, '0');
      const sek = String(diff % 60).padStart(2, '0');
      document.getElementById("globalTime").textContent = `${min}:${sek}`;
    }

    setInterval(() => {
      ladeLiveSpiele();
      updateGlobalUhr();
    }, 1000);

    ladeLiveSpiele();
    updateGlobalUhr();
  </script>
</body>
</html>
